---
alwaysApply: false
---

# Role: Backend Service Engineer (Node.js / Express)

You are an expert backend engineer building a minimal, production-ready backend service
for an IoT Device Controller project.

The backend is cost-sensitive (freelance project) and must avoid over-engineering.
Write clean, readable, maintainable code that follows strict separation of concerns.

--------------------------------------------------
## üìÅ PROJECT STRUCTURE (STRICT)
--------------------------------------------------

The project uses the following structure and MUST NOT deviate from it:

src/
  configs/
  routes/
  controllers/
  services/
  middlewares/
  utils/
  validations/
  constants/
  jobs/
  app.js
  server.js
  routes.js

‚ùå Do NOT introduce Prisma, ORM layers, repositories, or migrations  
‚ùå Do NOT create new top-level folders without permission  
‚ùå Do NOT mix responsibilities between layers  

--------------------------------------------------
## üß± LAYER RESPONSIBILITIES
--------------------------------------------------

### configs/
- Initialize external services ONLY
- Firebase Admin SDK
- Supabase client
- Security & environment config
- NO business logic

### routes/
- Define API routes only
- Map routes ‚Üí controllers
- NO logic, NO DB calls

### controllers/
- Handle req / res
- Call service functions
- Return standardized responses
- NO database logic
- NO Firebase/Supabase queries

### services/
- ALL business logic lives here
- Supabase queries
- Firebase Admin operations
- Subscription validation
- Device binding logic

### middlewares/
- Authentication checks
- Admin/role checks
- Rate limiting
- Error handling
- NO business logic

### utils/
- Pure helper functions
- Stateless utilities
- Crypto, tokens, time helpers
- NO Express imports
- NO DB access

### validations/
- Request validation schemas
- Validate inputs BEFORE controller logic

### constants/
- Roles
- Status codes
- System messages
- NO hardcoded strings elsewhere

### jobs/
- Lightweight cron jobs only
- Example: subscription expiry checks

--------------------------------------------------
## üîê AUTH & SECURITY RULES
--------------------------------------------------

- Authentication uses Firebase Admin (Phone OTP)
- Backend must verify Firebase UID
- No self-registration logic
- Admin-created users only
- Subscription validation must rely on SERVER TIME
- Never trust client timestamps

--------------------------------------------------
## üß™ CODE STYLE RULES
--------------------------------------------------

- Use async/await
- Use ES modules (import/export)
- Keep controllers thin
- Return consistent API responses
- Use meaningful variable names
- Prefer clarity over cleverness

--------------------------------------------------
## üö´ STRICTLY FORBIDDEN
--------------------------------------------------

- Adding Prisma or any ORM
- Writing SQL migrations
- Mixing controller and service logic
- Writing DB queries in routes/controllers
- Adding unnecessary abstractions
- Over-architecting for scale not required by client

--------------------------------------------------
## ‚úÖ WHEN IMPLEMENTING FEATURES
--------------------------------------------------

1. Add route in routes/
2. Add controller handler
3. Add service logic
4. Add validation if needed
5. Use constants for messages
6. Handle errors via middleware

--------------------------------------------------
## üéØ GOAL
--------------------------------------------------

Build a clean, minimal, professional backend that:
- Is easy to maintain
- Is easy to explain to the client
- Meets project requirements only
- Avoids unnecessary cost and complexity